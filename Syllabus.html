<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Syllabus Tracker</title>
  <style>
    body { 
      background:#0b0b0f; color:#f5f5f7; font-family:-apple-system, sans-serif; 
      margin:0; padding:12px;
    }
    .table-container {
      width:100%;
      overflow-x:auto;
    }
    table { 
      width:100%; border-collapse:collapse; margin:0 auto; 
      min-width:650px;    /* ensure structure */
    }
    th, td { 
      border:1px solid #2c2c2e; 
      text-align:center; 
      padding:10px; 
      vertical-align:middle; 
      font-size:clamp(14px, 2.5vw, 18px);
    }
    th { background:#1d1d1f; }
    .state-btn { 
      width:clamp(40px, 8vw, 48px); 
      height:clamp(40px, 8vw, 48px);
      border-radius:10px;
      border:1px solid #2c2c2e; background:#1d1d1f;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; margin:0 auto; font-size:clamp(18px, 5vw, 22px);
      line-height:1;
    }
    .icon { width:1.2em; height:1.2em; }
    .state-0 .icon path { stroke:#ff453a; }
    .state-1 .icon path { stroke:#ffd60a; }
    .state-2 .icon path { stroke:#32d74b; }
    .state-3 { color:#30db5b; }
  </style>
  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="table-container">
    <table id="trackerTable">
      <thead>
        <tr>
          <th>Chapter</th>
          <th>PCG</th>
          <th>CPM</th>
          <th>BCP</th>
          <th>PCP</th>
          <th>HCP</th>
          <th>PLE</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyA5iLF-J-WvNaYm63r8rDZU8_rtZsgwYng",
    authDomain: "my-todo-2e111.firebaseapp.com",
    databaseURL: "https://my-todo-2e111-default-rtdb.firebaseio.com",
    projectId: "my-todo-2e111",
    storageBucket: "my-todo-2e111.appspot.com",
    messagingSenderId: "765517702108",
    appId: "1:765517702108:web:2dfe7d6205040cfd2ea519"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const SUBJECTS = ["PCG","CPM","BCP","PCP","HCP","PLE"];
  const SUBJECT_LIMITS = { PCG:13, CPM:9, BCP:13, PCP:14, HCP:12, PLE:21 };
  const MAX_CHAPTERS = 21;

  function makeSVG(){
    const s = document.createElementNS('http://www.w3.org/2000/svg','svg');
    s.setAttribute('viewBox','0 0 24 24');
    s.setAttribute('fill','none');
    s.classList.add('icon');
    return s;
  }
  function makePath(d){
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', d);
    p.setAttribute('stroke-width','2');
    p.setAttribute('stroke-linecap','round');
    p.setAttribute('stroke-linejoin','round');
    return p;
  }

  const icons = {
    cross: () => { const s=makeSVG(); s.appendChild(makePath('M6 6L18 18M18 6L6 18')); return s; },
    check: () => { const s=makeSVG(); s.appendChild(makePath('M5 13l4 4L19 7')); return s; }
  };

  function applyState(btn, state){
    const s = state % 4;
    btn.dataset.state = s;
    btn.className = `state-btn state-${s}`;
    btn.innerHTML = '';
    if(s===0) btn.appendChild(icons.cross());
    else if(s===1) btn.appendChild(icons.cross());
    else if(s===2) btn.appendChild(icons.check());
    else if(s===3) btn.textContent = "👍";
  }

  function makeCell(subj, chap){
    const td = document.createElement('td');
    if(chap > SUBJECT_LIMITS[subj]){
      td.textContent = "—";
      return td;
    }
    const btn = document.createElement('button');
    btn.type = 'button';
    applyState(btn, 0);
    btn.dataset.subject = subj;
    btn.dataset.chapter = chap;

    const ref = db.ref(`syllabusTracker/global/${subj}/${chap}`);
    ref.on('value', snap => {
      const val = snap.val();
      if(val !== null) applyState(btn, val);
    });

    btn.addEventListener('click', ()=>{
      const cur = Number(btn.dataset.state)||0;
      const newState = (cur+1) % 4;
      applyState(btn, newState);
      ref.set(newState);
    });

    td.appendChild(btn);
    return td;
  }

  function buildTable(){
    const tbody = document.querySelector('#trackerTable tbody');
    for(let ch=1; ch<=MAX_CHAPTERS; ch++){
      const tr = document.createElement('tr');
      const tdCh = document.createElement('td');
      tdCh.textContent = `Chapter ${String(ch).padStart(2,'0')}`;
      tr.appendChild(tdCh);
      for(const s of SUBJECTS){
        tr.appendChild(makeCell(s, ch));
      }
      tbody.appendChild(tr);
    }
  }

  buildTable();
</script>
</body>
</html>
